<div class="wizard-layout" *ngIf="schema">
  <button class="sidebar-toggle" type="button" (click)="sidebarOpen = !sidebarOpen">
    ☰ Menu
  </button>

  <app-wizard-sidebar [schema]="schema" [currentIndex]="index" (sectionChange)="navigateToSection($event)"
    [formValid]="form.valid" [requestId]="requestId" [saveStatus]="saveStatus" [class.open]="sidebarOpen">
  </app-wizard-sidebar>
  <div class="backdrop" *ngIf="sidebarOpen" (click)="sidebarOpen = false"></div>

  <div class="wizard-content">
    <div class="form-title">{{ schema.title }}</div>

    <form [formGroup]="form" class="form" (ngSubmit)="onSubmit()">

      <div class="form-card" *ngFor="let field of currentSection.fields">
        <app-dynamic-field [field]="field" [form]="form"></app-dynamic-field>
      </div>

      <div class="save-status" [ngClass]="saveStatus">
        <ng-container [ngSwitch]="saveStatus">
          <span *ngSwitchCase="'saving'">Saving…</span>
          <span *ngSwitchCase="'saved'">Saved</span>
          <span *ngSwitchCase="'error'">Error — retrying…</span>
        </ng-container>
      </div>

      <app-wizard-footer [index]="index" [isLastSection]="isLastSection" [saveStatus]="saveStatus"
        [formInvalid]="form.invalid" (prevClick)="prev()" (nextClick)="next()" (submitClick)="onSubmit()">
      </app-wizard-footer>

    </form>
  </div>
</div>
